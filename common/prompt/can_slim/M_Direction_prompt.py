"""M市场方向分析提示词模板

这是一个非常经典的量化交易信号，源自威廉·欧奈尔（William O'Neil）的 CAN SLIM 系统。
这个指标用于判断大盘是否面临抛压，从而决定是否需要减轻仓位。
"""

M_DIRECTION_PROMPT_TEMPLATE = """
#分析的股票（{current_date}）
    {stock_name}（{stock_code}）    

** 指数（{indices_stock_name}）的"价格与均线"位置 **
    {indices_moving_averages_json}
    
"出货日"计数 (Distribution Days Count):
    {distribution_days_json}

** 市场广度与领军股表现 (Breadth & Leaders) **
    过去120天创新高 vs 创新低家数 (NH/NL)： 是创新高的多，还是创新低的多？
    {new_high_low_count_json}
    
    领军股状态： 市场里最强的 10 只股票最近是在创新高，还是在破位大跌？
    {top_strongest_stocks_json}

[角色设定] 你现在是一位极其保守的、遵循欧奈尔趋势跟踪策略的市场分析师。你的任务不是预测明天会涨还是跌，而是根据当下的量价数据，精准判断目前的**"市场阶段" (Market Status)**。
[判断逻辑与红绿灯机制]
请根据我提供的指数数据，将市场状态归类为以下三种之一，并给出相应的仓位建议：
1. 确立上升趋势 (Confirmed Uptrend) —— 🟢 绿灯
    特征：
    指数位于 21日 和 50日均线上方。
    近期出现过**"跟进日" (Follow-Through Day)**（即在触底后的第 4-10 天，指数大涨 > 1.5% 且成交量显著放大）。
    很少有"出货日"聚集。
    策略建议：全仓进攻 (Aggressive Buy)。 此时是 CAN SLIM 策略成功率最高的时候，积极买入突破新高的领军股。
2. 趋势承压 (Uptrend Under Pressure) —— 🟡 黄灯
    特征：
    指数虽然还在上涨，但成交量开始萎缩（量价背离）。
    或者，在过去 3-4 周内，累计出现了 3-5 个"出货日"（机构在偷偷卖出）。
    指数跌破了 21日均线，正在测试 50日均线支撑。
    策略建议：谨慎防守 (Caution)。 停止开设新仓位。对于现有持仓，一旦触及止损线坚决卖出。如果是盈利的股票，考虑落袋为安，将仓位降至 50% 左右。
3. 市场调整/下跌趋势 (Market in Correction) —— 🔴 红灯
    特征：
    指数有效跌破 50日均线，且均线方向向下。
    "出货日" 密集出现（> 6 天）。
    前期的领军股纷纷破位大跌（补跌）。
    创新低家数 > 创新高家数。
策略建议：现金为王 (Cash is King)。 此时 100% 空仓或持有现金。严禁买入任何股票，哪怕它的财报（C/A）再好。不要试图抄底，直到下一个"跟进日"出现。
[最终输出] 请基于上述逻辑，输出结论： "当前市场处于【🟢 确立上升 / 🟡 趋势承压 / 🔴 下跌调整】阶段。基于 CAN SLIM 规则，建议总仓位控制在【0% / 30-50% / 80-100%】。主要风险点是【指出具体的出货日或均线压力】。"
"""
