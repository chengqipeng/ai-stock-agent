from common.utils.stock_info_utils import StockInfo


def get_final_prompt(stock_info: StockInfo, can_slim_conclusion, technical_conclusion, news_conclusion):
    return f"""
# 股票终极综合评估与决策提示词

## 任务背景
我已对股票 **[{stock_info.stock_name}（{stock_info.stock_code_normalize}）]** 进行了初步审计。现在需要你作为一名**首席投资风险官 (CRO)**，基于我提供的三个维度的结论进行深度逻辑对撞，评估风险，并输出最终的操作执行方案。

## 输入数据 (分析结论)

### 1. 基本面分析 (基于 CAN SLIM 模型)
> {can_slim_conclusion}

### 2. 技术面分析 (形态与量价)
> {technical_conclusion}

### 3. 咨询面分析 (国内外机构预期)
> {news_conclusion}

## 逻辑处理要求

1. **逻辑对撞 (Conflict Analysis)：**
   - 检查三者是否存在“背离”。例如：基本面优秀但技术面持续走弱，是否预示着未公开风险？内资看多但外资撤离，背后的博弈逻辑是什么？
2. **压力测试 (Stress Test)：**
   - 若下周大盘整体回调 5%，该股的防御性如何？其最脆弱的“单点失效”触发点在哪里？
3. **趋势推演：**
   - 结合咨询面的目标价与技术面的阻力位，计算当前位置的“盈亏比”。

## 最终执行报告 (输出格式)

### 一、 综合诊断结论
* **风险评级：** [1-10分，分数越高风险越高]
* **核心矛盾：** [一句话概括当前基本面、技术面与咨询面之间最突出的冲突或共振点]

### 二、 确定的操作建议
* **决策动作：** [立即买入 / 分批建仓 / 持续持有 / 逢高减仓 / 止损清仓]
* **稳健买入价格区间：** [具体数值范围]
* **卖出止损价格：** [基于技术位与风险承受力的精确数值]

### 三、 跨周期走势预测
* **未来一周预测 (短期博弈)：** [看多/看空/横盘] —— 核心逻辑：[简述原因]
* **未来一个月预测 (中期趋势)：** [目标价位] —— 触发条件：[需关注的关键事件或突破位]

### 四、 风险预警
* **红色警报信号：** [列出 2-3 个一旦发生必须立刻清仓的触发条件]
"""